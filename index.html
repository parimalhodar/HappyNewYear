<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Your Diwali & New Year Wish!</title>

  <!-- Meta Tags for Social Sharing (WhatsApp, Facebook, etc.) -->
  <meta property="og:title" content="A Special Diwali & New Year Wish!">
  <meta property="og:description" content="Someone sent you a beautiful greeting for the festival of lights!">
  <meta property="og:image" content="https://i.imgur.com/7z3kR9b.gif">
  <meta property="og:type" content="website">

  <style>
    /* Import festive Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Tangerine:wght@700&family=Poppins:wght@400;600&display=swap');

    /* ==== ANIMATIONS ==== */
    @keyframes text-glow {
      0%, 100% { color: #ffe6a7; text-shadow: 0 0 10px #ffc107, 0 0 20px #ffc107; }
      50%      { color: #fff8e1; text-shadow: 0 0 20px #ffeb3b, 0 0 30px #ffc107, 0 0 40px #ff9800; }
    }
    @keyframes card-entry {
      from { transform: translateY(40px) scale(0.95); opacity: 0; }
      to   { transform: translateY(0) scale(1); opacity: 1; }
    }
    @keyframes sparkle {
      0%, 100% { opacity: 0; transform: scale(0); }
      50%      { opacity: 1; transform: scale(1.2); }
      75%      { opacity: 0; }
    }
    @keyframes diya-flicker {
      0%, 100% { opacity: 1; transform: scale(1); filter: brightness(1.1); }
      50%      { opacity: 0.9; transform: scale(1.05); filter: brightness(1.3); }
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* ==== PAGE LAYOUT ==== */
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(-45deg, #4c0000, #a80000, #ff5252, #ff8c42);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      font-family: 'Poppins', 'Segoe UI', sans-serif;
      padding: 20px;
      box-sizing: border-box;
      overflow: hidden;
      text-align: center;
    }

    /* Decorative Elements */
    .diya {
      position: absolute;
      font-size: 2.5rem;
      animation: diya-flicker 2.5s ease-in-out infinite;
      text-shadow: 0 0 15px rgba(255, 165, 0, 0.8);
      pointer-events: none; /* Prevents them from being clickable */
    }
    .diya.d1 { top: 10%; left: 10%; animation-delay: 0.5s; }
    .diya.d2 { top: 20%; right: 8%; }
    .diya.d3 { bottom: 15%; left: 5%; animation-delay: 1s; }
    .diya.d4 { bottom: 10%; right: 15%; animation-delay: 1.5s; }

    .sparkle {
      position: absolute;
      width: 10px; height: 10px;
      background: gold;
      border-radius: 50%;
      box-shadow: 0 0 10px gold;
      animation: sparkle 4s ease-in-out infinite;
      pointer-events: none;
    }

    /* ==== Main Containers ==== */
    .container {
      max-width: 600px;
      width: 100%;
      position: relative;
    }
    .card {
      background: rgba(0, 0, 0, 0.25);
      backdrop-filter: blur(12px);
      padding: 30px 40px;
      border-radius: 20px;
      box-shadow: 0 10px 50px rgba(0,0,0,0.4);
      border: 2px solid rgba(255, 215, 0, 0.7);
      animation: card-entry 1.2s cubic-bezier(0.165, 0.84, 0.44, 1);
    }

    /* ==== Creation Form Styles ==== */
    #creation-form h2 {
      font-family: 'Tangerine', cursive;
      font-size: 3rem; margin: 0 0 20px 0;
      color: #ffd700; font-weight: 700;
      animation: text-glow 2s infinite alternate;
    }
    .input-field {
      width: 100%; padding: 15px;
      border: 1px solid #ddd;
      border-radius: 10px; font-size: 1.1rem;
      box-sizing: border-box; background: rgba(255,255,255,0.9);
      color: #333; margin-bottom: 20px;
    }
    .input-field:focus {
      outline: none; border-color: #ff8c42;
      box-shadow: 0 0 10px rgba(255, 140, 66, 0.5);
    }
    #createBtn {
      padding: 15px 30px;
      background: linear-gradient(135deg, #ff6b6b, #ff8e53);
      color: #fff; border: none; border-radius: 50px;
      cursor: pointer; font-weight: bold; font-size: 1.2rem;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
    }
    #createBtn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
    }

    /* ==== Greeting Card Display Styles ==== */
    #greeting-card .headline {
      font-family: 'Tangerine', cursive;
      font-size: clamp(3rem, 15vw, 4.5rem);
      margin: 0 0 15px 0;
      color: #fff8e1;
      animation: text-glow 2.5s ease-in-out infinite alternate;
      font-weight: 700;
      line-height: 1.1;
    }
    .wish-text {
      font-size: 1.15rem; color: #ffebcd; line-height: 1.7;
    }
    .sender-note {
      margin-top: 25px; font-style: italic;
      color: #ffd700; font-size: 1.2rem; font-weight: 600;
    }
    .gif-container img {
      max-width: 100%; height: auto;
      border-radius: 15px; margin: 20px 0;
      border: 3px solid #ffd700;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
    }

    /* ==== Share Buttons ==== */
    #share-buttons {
      display: flex; flex-direction: column;
      gap: 15px; margin-top: 25px;
    }
    .share-btn {
      display: inline-flex; align-items: center; justify-content: center;
      gap: 10px; padding: 15px 25px;
      color: #fff; border: none; border-radius: 50px;
      font-size: 1.1rem; font-weight: bold; text-decoration: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: all 0.3s ease; cursor: pointer;
    }
    .share-btn:hover { transform: scale(1.05); }
    #whatsappButton { background: #25D366; }
    #copyButton { background: #ff8e53; }

    /* ==== Music & Toast ==== */
    #musicBtn {
      position: fixed; top: 20px; right: 20px;
      background: rgba(0,0,0,0.5); color: white;
      border: none; border-radius: 50%;
      width: 50px; height: 50px; font-size: 1.5rem;
      cursor: pointer; z-index: 999;
      display: flex; justify-content: center; align-items: center;
    }
    #toast {
      position: fixed; bottom: -100px; left: 50%;
      transform: translateX(-50%);
      background: #333; color: #fff;
      padding: 12px 25px; border-radius: 50px;
      transition: bottom 0.5s ease; z-index: 1000;
    }
    #toast.show { bottom: 30px; }

    /* ==== Responsive Design ==== */
    @media (max-width: 600px) {
      .card { padding: 25px; }
    }
  </style>
</head>
<body>

  <!-- Background Decorative Elements -->
  <div class="diya d1">ðŸª”</div> <div class="diya d2">ðŸª”</div>
  <div class="diya d3">ðŸª”</div> <div class="diya d4">ðŸª”</div>

  <!-- Music Controls -->
  <button id="musicBtn">ðŸ”ˆ</button>
  <audio id="bgMusic" loop>
    <!-- You can replace this audio source with your own -->
    <source src="https://dl.dropbox.com/s/b71v4s460bin0px/diwali-lounge-music.mp3" type="audio/mpeg">
  </audio>
  
  <div class="container">
    <!-- This container will be dynamically filled by JavaScript -->
    <div id="content-container"></div>
  </div>

  <!-- Toast Notification element -->
  <div id="toast"></div>

  <!-- HTML TEMPLATES (hidden until used by JavaScript) -->
  <template id="form-template">
    <div id="creation-form" class="card">
      <h2>Create Your Diwali Wish</h2>
      <input type="text" id="senderNameInput" class="input-field" placeholder="Enter Your Name..." required>
      <button id="createBtn" onclick="createWish()">Create Wish Link âœ¨</button>
    </div>
  </template>

  <template id="greeting-template">
    <div id="greeting-card" class="card">
      <h1 class="headline">Happy Diwali!</h1>
      <div class="gif-container">
        <img src="https://i.imgur.com/7z3kR9b.gif" alt="Happy Diwali Animated GIF">
      </div>
      <p class="wish-text">May the festival of lights fill your life with a glow of happiness and a sparkle of joy. âœ¨</p>
      <p class="wish-text">Wishing you a prosperous and wonderful New Year! ðŸŽ‰</p>
      <p class="sender-note">
        With Best Wishes,<br>
        <b id="senderNameDisplay">Your Friend</b>
      </p>
      <div id="share-buttons">
        <a id="whatsappButton" class="share-btn" href="#" onclick="shareToWhatsApp(); return false;">ðŸ“± Share on WhatsApp</a>
        <button id="copyButton" class="share-btn" onclick="copyLink()">ðŸ”— Copy Link</button>
      </div>
    </div>
  </template>

  <script>
    // Helper to get elements easily
    const $ = (selector) => document.querySelector(selector);
    const contentContainer = $('#content-container');

    // Function to show a temporary message (a "toast")
    const showToast = (message) => {
      const toast = $('#toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    };

    // Function to dynamically create background sparkles
    const createSparkles = () => {
      const body = $('body');
      for (let i = 0; i < 30; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = `${Math.random() * 100}%`;
        sparkle.style.top = `${Math.random() * 100}%`;
        sparkle.style.animationDelay = `${Math.random() * 4}s`;
        sparkle.style.animationDuration = `${Math.random() * 2 + 3}s`;
        body.appendChild(sparkle);
      }
    };

    // Main logic to decide what to show on the page
    const handlePageLoad = () => {
      const params = new URLSearchParams(window.location.search);
      const senderName = params.get('from');

      if (senderName) {
        // If a sender's name is in the URL, show the greeting card
        const decodedSender = decodeURIComponent(senderName.replace(/\+/g, ' '));
        
        // Use the greeting template
        const greetingTemplate = $('#greeting-template').content.cloneNode(true);
        contentContainer.appendChild(greetingTemplate);
        
        // Fill in the sender's name
        $('#senderNameDisplay').textContent = decodedSender;
        document.title = `A Diwali Wish from ${decodedSender}!`;
        
        // Try to play music automatically (might be blocked by browser)
        $('#bgMusic').play().catch(() => {});

      } else {
        // If no sender name, show the creation form
        const formTemplate = $('#form-template').content.cloneNode(true);
        contentContainer.appendChild(formTemplate);
      }
    };

    // Function called by the "Create" button
    const createWish = () => {
      const senderName = $('#senderNameInput').value.trim();
      if (!senderName) {
        showToast('Please enter your name!');
        return;
      }
      // Create the new URL and redirect the page
      const encodedSender = encodeURIComponent(senderName);
      const wishURL = `${window.location.origin}${window.location.pathname}?from=${encodedSender}`;
      window.location.href = wishURL;
    };

    // Function to copy the current wish link
    const copyLink = () => {
      navigator.clipboard.writeText(window.location.href).then(() => {
        showToast('âœ… Link copied to clipboard!');
      }).catch(() => {
        showToast('âŒ Failed to copy link.');
      });
    };

    // Function to format and open the WhatsApp sharing link
    const shareToWhatsApp = () => {
      const senderName = $('#senderNameDisplay').textContent;
      const link = window.location.href;
      
      const message = encodeURIComponent(
        `ðŸª”âœ¨ ${senderName} is sending you warm wishes for a Happy Diwali & a Prosperous New Year! ðŸŽ‰\n\nClick the link to see your special greeting:\n${link}`
      );
      
      const whatsappURL = `https://api.whatsapp.com/send?text=${message}`;
      window.open(whatsappURL, '_blank');
    };

    // Function to play or pause the music
    const toggleMusic = () => {
      const music = $('#bgMusic');
      const btn = $('#musicBtn');
      if (music.paused) {
        music.play();
        btn.textContent = 'ðŸ”ˆ';
      } else {
        music.pause();
        btn.textContent = 'ðŸ”‡';
      }
    };
    $('#musicBtn').addEventListener('click', toggleMusic);

    // This runs when the page is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
      createSparkles();
      handlePageLoad();
    });
  </script>

</body>
</html>
