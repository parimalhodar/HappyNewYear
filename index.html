<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ‡ Happy Diwali</title>
<style>
  body {
    background: radial-gradient(circle, #1b1b1b, #000);
    color: gold;
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    height: 100vh;
    margin: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  h1 {
    font-size: 2.5em;
    margin-bottom: 5px;
    text-shadow: 0 0 15px #ffcc00;
  }
  .sender-name {
    font-size: 1.2em;
    color: #fff;
    margin-top: 10px;
    min-height: 1.2em; /* Prevents layout shift when name loads */
  }
  .share-btn {
    background: linear-gradient(45deg, #25D366, #128C7E);
    color: white;
    border: none;
    padding: 15px 30px;
    margin-top: 40px;
    border-radius: 30px;
    font-size: 1.1em;
    cursor: pointer;
    transition: 0.3s;
  }
  .share-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 20px #25D366;
  }
  /* Style for the input form */
  .name-input-container {
    margin-top: 20px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
  }
  .name-input-container p {
    color: white; 
    margin-bottom: 15px;
  }
  .name-input-container input[type="text"] {
    padding: 10px;
    border: 2px solid gold;
    border-radius: 5px;
    background: #000;
    color: gold;
    font-size: 1em;
    outline: none;
    max-width: 150px;
  }
  .name-input-container button {
    margin-left: 10px;
    padding: 10px 20px;
    background: gold;
    color: #000;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: 0.2s;
  }
  .name-input-container button:hover {
    background: #fff;
  }
</style>
</head>
<body>

  <h1>ðŸŽ‡ Happy Diwali</h1>
  <p class="sender-name"><strong>- From: </strong><span id="senderNameDisplay"></span></p>

  <div id="inputForm" class="name-input-container" style="display: none;">
    <p>Enter your name to personalize your wish:</p>
    <input type="text" id="userNameInput" placeholder="Your Name" maxlength="20">
    <button onclick="setNameAndShare()">Share Now</button>
  </div>

  <button class="share-btn" id="shareButton" onclick="shareOnWhatsApp()" style="display: none;">
    ðŸŽ‰ Share this Personalized Wish
  </button>

  <script>
    // 1. Function to get the 'name' parameter from the URL (?name=Sagar)
    function getParameterByName(name, url = window.location.href) {
      name = name.replace(/[\[\]]/g, '\\$&');
      const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      // Decode the URL part and replace '+' with space
      return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    // 2. Function to handle sharing after the name is set
    function shareOnWhatsApp() {
      // Get the name currently displayed on the page
      const currentSenderName = document.getElementById('senderNameDisplay').textContent;
      
      // THIS IS THE KEY: We only use the base URL (e.g., https://parimalhodar.github.io/HappyNewYear/)
      // The next receiver will be prompted to enter THEIR name.
      const baseUrl = window.location.origin + window.location.pathname;

      // The personalized message for WhatsApp
      const message = `âœ¨ Wishing you a very Happy Diwali! ðŸª”\n\n- From: ${currentSenderName}\n\n*Click here to receive and share your own personalized wish:*\n${baseUrl}`;
      
      const encodedMessage = encodeURIComponent(message);
      const url = `https://wa.me/?text=${encodedMessage}`;
      window.open(url, '_blank');
    }

    // 3. Function to set the name from the input field and update the URL
    function setNameAndShare() {
      const input = document.getElementById('userNameInput');
      let newSenderName = input.value.trim();

      if (newSenderName) {
        // Capitalize the first letter for a cleaner look
        newSenderName = newSenderName.charAt(0).toUpperCase() + newSenderName.slice(1);
        
        // Update the URL in the browser with the new name parameter
        // e.g., .../index.html?name=Kiran
        const newUrl = window.location.origin + window.location.pathname + `?name=${encodeURIComponent(newSenderName)}`;
        history.pushState(null, '', newUrl); // Updates URL without page reload

        // Update the display and hide the form, show the share button
        document.getElementById('senderNameDisplay').textContent = newSenderName;
        document.getElementById('inputForm').style.display = 'none';
        document.getElementById('shareButton').style.display = 'block';
        document.title = `ðŸŽ‡ Happy Diwali from ${newSenderName}`;

        // Immediately trigger the sharing function
        shareOnWhatsApp();
      } else {
        alert("Please enter your name to share!");
        input.focus();
      }
    }

    // 4. Initialization function run on page load
    function initializePage() {
      const senderNameDisplay = document.getElementById('senderNameDisplay');
      const shareButton = document.getElementById('shareButton');
      const inputForm = document.getElementById('inputForm');

      // Get the name from the URL parameter
      let senderName = getParameterByName('name');

      if (senderName) {
        // A name was received (e.g., from a friend's share)
        senderName = senderName.trim();
        senderNameDisplay.textContent = senderName;
        shareButton.style.display = 'block'; 
        document.title = `ðŸŽ‡ Happy Diwali from ${senderName}`;
      } else {
        // This is the first visit or they clicked the base share link
        senderNameDisplay.textContent = 'A loved one';
        inputForm.style.display = 'block'; // Prompt them to enter their name
      }
    }

    // Run the initialization function when the page loads
    window.onload = initializePage;
  </script>

</body>
</html>
