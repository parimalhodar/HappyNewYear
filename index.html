<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ‡ Happy Diwali</title>
<style>
  /* --- CSS Styles (Same as before) --- */
  body {
    background: radial-gradient(circle, #1b1b1b, #000);
    color: gold;
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    height: 100vh;
    margin: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  h1 {
    font-size: 2.5em;
    margin-bottom: 5px;
    text-shadow: 0 0 15px #ffcc00;
  }
  .sender-name {
    font-size: 1.3em;
    color: #fff;
    margin-top: 10px;
    min-height: 1.3em; 
  }
  .share-btn {
    background: linear-gradient(45deg, #25D366, #128C7E);
    color: white;
    border: none;
    padding: 15px 30px;
    margin-top: 40px;
    border-radius: 30px;
    font-size: 1.1em;
    cursor: pointer;
    transition: 0.3s;
  }
  .share-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 20px #25D366;
  }
  .name-input-container {
    margin-top: 20px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
  }
  .name-input-container p {
    color: white; 
    margin-bottom: 15px;
  }
  .name-input-container input[type="text"] {
    padding: 10px;
    border: 2px solid gold;
    border-radius: 5px;
    background: #000;
    color: gold;
    font-size: 1em;
    outline: none;
    max-width: 150px;
  }
  .name-input-container button {
    margin-left: 10px;
    padding: 10px 20px;
    background: gold;
    color: #000;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: 0.2s;
  }
  .name-input-container button:hover {
    background: #fff;
  }
</style>
</head>
<body>

  <h1>ðŸŽ‡ Happy Diwali</h1>
  <p class="sender-name"><strong>- From: </strong><span id="senderNameDisplay"></span></p>

  <div id="inputForm" class="name-input-container" style="display: none;">
    <p>Enter your name to see a preview and share:</p>
    <input type="text" id="userNameInput" placeholder="Your Name" maxlength="20">
    <button onclick="setNameAndShare()">Share Now</button>
  </div>

  <button class="share-btn" id="shareButton" onclick="shareOnWhatsApp()" style="display: none;">
    ðŸŽ‰ Share this Personalized Wish
  </button>

  <script>
    // ----------------------------------------------------------------------
    // 1. LOGIC FOR READING THE NAME (Receiving Mode)
    // ----------------------------------------------------------------------

    // Reads the 'name' parameter from the URL (e.g., ?name=Parimal)
    function getParameterByName(name, url = window.location.href) {
      name = name.replace(/[\[\]]/g, '\\$&');
      const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    // Handles the core page setup on load
    function initializePage() {
      const senderNameDisplay = document.getElementById('senderNameDisplay');
      const shareButton = document.getElementById('shareButton');
      const inputForm = document.getElementById('inputForm');
      const userNameInput = document.getElementById('userNameInput');

      let senderName = getParameterByName('name'); // Check URL for a name

      if (senderName) {
        // SCENARIO 1: Name is in URL (e.g., Sagar receives Parimal's link: ?name=Parimal)
        senderName = senderName.trim();
        senderNameDisplay.textContent = senderName; // Displays "Parimal"
        document.title = `ðŸŽ‡ Happy Diwali from ${senderName}`;
        shareButton.style.display = 'block'; // Shows the share button
      } else {
        // SCENARIO 2: No name in URL (e.g., Ashok receives the base URL)
        senderNameDisplay.textContent = 'A loved one'; // Default text
        inputForm.style.display = 'block'; // Shows the input form

        // Attach real-time preview listener
        userNameInput.addEventListener('input', updatePreview);
      }
    }

    // ----------------------------------------------------------------------
    // 2. LOGIC FOR UPDATING/SHARING THE NAME (Sharing Mode)
    // ----------------------------------------------------------------------

    // Updates the displayed name as the user types (Real-time preview)
    function updatePreview() {
      const input = document.getElementById('userNameInput');
      const display = document.getElementById('senderNameDisplay');
      let name = input.value.trim();
      
      if (name) {
        name = name.charAt(0).toUpperCase() + name.slice(1);
        display.textContent = name;
      } else {
        display.textContent = 'A loved one';
      }
    }

    // Runs when the user clicks 'Share Now' on the input form
    function setNameAndShare() {
      const input = document.getElementById('userNameInput');
      let newSenderName = input.value.trim();

      if (newSenderName) {
        newSenderName = newSenderName.charAt(0).toUpperCase() + newSenderName.slice(1);
        
        // Key step: Update the current browser URL with the new name parameter
        // This is necessary because if Sagar opens his new URL, it should show his name
        const newUrl = window.location.origin + window.location.pathname + `?name=${encodeURIComponent(newSenderName)}`;
        history.pushState(null, '', newUrl); // Changes the URL to .../?name=Sagar

        // Update the display and switch to "received" mode
        document.getElementById('senderNameDisplay').textContent = newSenderName;
        document.getElementById('inputForm').style.display = 'none';
        document.getElementById('shareButton').style.display = 'block';
        document.title = `ðŸŽ‡ Happy Diwali from ${newSenderName}`;

        // Immediately trigger sharing (sending the message as Sagar)
        shareOnWhatsApp();
      } else {
        alert("Please enter your name to share!");
        input.focus();
      }
    }

    // Runs when the user clicks 'Share this Personalized Wish'
    function shareOnWhatsApp() {
      const currentSenderName = document.getElementById('senderNameDisplay').textContent;
      
      // CRITICAL STEP: Get ONLY the base URL (no name parameter)
      // This ensures the NEXT receiver (Ashok) is prompted to enter his name.
      const baseUrl = window.location.origin + window.location.pathname;

      // Message includes the name currently displayed on the screen
      const message = `âœ¨ Wishing you a very Happy Diwali! ðŸª”\n\n- From: ${currentSenderName}\n\n*Click here to receive and share your own personalized wish:*\n${baseUrl}`;
      
      const encodedMessage = encodeURIComponent(message);
      const url = `https://wa.me/?text=${encodedMessage}`;
      window.open(url, '_blank');
    }

    // Run the initialization function when the page loads
    window.onload = initializePage;
  </script>

</body>
</html>
